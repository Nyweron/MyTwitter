var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$location",function(e,t,o){e.$on("login",function(t,o){e.currentUser=o}),e.$on("register",function(t,o){e.registerResponse=o}),e.disableRegisterResponse=function(){e.registerResponse=null},e.logout=function(){console.log("logout"),e.currentUser=null,t.logout(),o.path("/")},t.isSessionActive()&&t.getUser().then(function(t){e.currentUser=t})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,t,o){e.login=function(n,r){t.login(n,r).then(function(t){e.$emit("login",t),o.path("/")})}}]),app.controller("PostsCtrl",["$scope","PostsSvc",function(e,t){e.addPost=function(){e.postBody&&t.create({username:"nyweron",body:e.postBody}).success(function(t){e.postBody=null})},e.$on("ws:new_post",function(t,o){e.$apply(function(){e.posts.unshift(o)})}),t.fetch().success(function(t){e.posts=t})}]),app.service("PostsSvc",["$http",function(e){this.fetch=function(){return e.get("/posts")},this.create=function(t){return e.post("/posts",t)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,t){e.register=function(o,n){e.nameRequired="",e.passwordRequired="",e.nameRequired=o?"":"Name Required",e.passwordRequired=n?"":"Password Required",o&&n&&t.register(o,n).then(function(t){e.$emit("register","Konto zarejestrowane poprawnie, zaloguj siÄ™."),e.username="",e.password=""})}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"ApplicationCtrl",templateUrl:"posts.html"})}]),angular.module("app").service("UserSvc",["$http","$window",function(e,t){var o=this;o.getUser=function(){return e.get("/users").then(function(e){return e.data})},o.login=function(t,n){return e.post("/sessions",{username:t,password:n}).then(function(t){return o.token=t.data,o.setToken(o.token),e.defaults.headers.common["X-Auth"]=t.data,o.getUser()})},o.register=function(t,o){return e.post("/users",{username:t,password:o}).then(function(e){return e})},o.logout=function(){t.localStorage.clear(),delete e.defaults.headers.common["X-Auth"]},o.setToken=function(e){return t.localStorage.token=e},o.getToken=function(){return t.localStorage.token},o.isSessionActive=function(){return!!t.localStorage.token},o.setXAuth=function(){return e.defaults.headers.common["X-Auth"]=o.getToken()}}]),angular.module("app").service("WebSocketSvc",["$rootScope",function(e){function t(){return"https:"===window.location.protocol?"wss://"+window.location.host:"ws://"+window.location.host}var o;this.connect=function(){(o=new WebSocket(t())).onopen=function(){console.log("WebSocket connected")},o.onmessage=function(t){var o=JSON.parse(t.data);e.$broadcast("ws:"+o.topic,o.data)}},this.send=function(e,t){var n=JSON.stringify({topic:e,data:t});o.send(n)}}]).run(["WebSocketSvc",function(e){e.connect()}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuc3ZjLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsIiRvbiIsIl8iLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJyZXNwb25zZSIsInJlZ2lzdGVyUmVzcG9uc2UiLCJkaXNhYmxlUmVnaXN0ZXJSZXNwb25zZSIsImxvZ291dCIsImNvbnNvbGUiLCJsb2ciLCJwYXRoIiwiaXNTZXNzaW9uQWN0aXZlIiwiZ2V0VXNlciIsInRoZW4iLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCIkZW1pdCIsIlBvc3RzU3ZjIiwiYWRkUG9zdCIsInBvc3RCb2R5IiwiY3JlYXRlIiwiYm9keSIsInN1Y2Nlc3MiLCJwb3N0IiwiJGFwcGx5IiwicG9zdHMiLCJ1bnNoaWZ0IiwiZmV0Y2giLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwicmVnaXN0ZXIiLCJuYW1lUmVxdWlyZWQiLCJwYXNzd29yZFJlcXVpcmVkIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCIkd2luZG93Iiwic3ZjIiwiZGF0YSIsInRva2VuIiwic2V0VG9rZW4iLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJsb2NhbFN0b3JhZ2UiLCJjbGVhciIsImdldFRva2VuIiwic2V0WEF1dGgiLCIkcm9vdFNjb3BlIiwid2Vic29ja2V0SG9zdCIsIndpbmRvdyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJob3N0IiwiY29ubmVjdGlvbiIsImNvbm5lY3QiLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIiRicm9hZGNhc3QiLCJ0b3BpYyIsInNlbmQiLCJqc29uIiwic3RyaW5naWZ5IiwicnVuIiwiV2ViU29ja2V0U3ZjIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFBQSxJQUFBQyxRQUFBQyxPQUFBLE9BQ0EsWUNEQUQsUUFBQUMsT0FBQSxPQUNBQyxXQUFBLG1CQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0FGLEVBQUFHLElBQUEsUUFBQSxTQUFBQyxFQUFBQyxHQUNBTCxFQUFBTSxZQUFBRCxJQUVBTCxFQUFBRyxJQUFBLFdBQUEsU0FBQUMsRUFBQUcsR0FDQVAsRUFBQVEsaUJBQUFELElBR0FQLEVBQUFTLHdCQUFBLFdBQ0FULEVBQUFRLGlCQUFBLE1BR0FSLEVBQUFVLE9BQUEsV0FDQUMsUUFBQUMsSUFBQSxVQUNBWixFQUFBTSxZQUFBLEtBQ0FMLEVBQUFTLFNBQ0FSLEVBQUFXLEtBQUEsTUFHQVosRUFBQWEsbUJBQ0FiLEVBQUFjLFVBQUFDLEtBQUEsU0FBQVgsR0FDQUwsRUFBQU0sWUFBQUQsT0N0QkFSLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0FGLEVBQUFpQixNQUFBLFNBQUFDLEVBQUFDLEdBQ0FsQixFQUFBZ0IsTUFBQUMsRUFBQUMsR0FDQUgsS0FBQSxTQUFBWCxHQUNBTCxFQUFBb0IsTUFBQSxRQUFBZixHQUNBSCxFQUFBVyxLQUFBLFdDTkFqQixJQUFBRyxXQUFBLGFBQUEsU0FBQSxXQUFBLFNBQUFDLEVBQUFxQixHQUNBckIsRUFBQXNCLFFBQUEsV0FDQXRCLEVBQUF1QixVQUNBRixFQUFBRyxRQUNBTixTQUFBLFVBQ0FPLEtBQUF6QixFQUFBdUIsV0FDQUcsUUFBQSxTQUFBQyxHQUNBM0IsRUFBQXVCLFNBQUEsUUFNQXZCLEVBQUFHLElBQUEsY0FBQSxTQUFBQyxFQUFBdUIsR0FDQTNCLEVBQUE0QixPQUFBLFdBQ0E1QixFQUFB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TUFBQUEsRUFBQTFCLEtBQUFBLElBQ0FnQixFQUFBVyxLQUFBQyxPQUVBRSxLQUFBLGVBQUEsU0FBQUMsR0FDQUEsRUFBQWQiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXHJcbiAgICAnbmdSb3V0ZSdcclxuXSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTdmMsICRsb2NhdGlvbikge1xyXG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oXywgdXNlcikge1xyXG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyXHJcbiAgICAgICAgfSlcclxuICAgICAgICAkc2NvcGUuJG9uKCdyZWdpc3RlcicsIGZ1bmN0aW9uKF8sIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWdpc3RlclJlc3BvbnNlID0gcmVzcG9uc2VcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAkc2NvcGUuZGlzYWJsZVJlZ2lzdGVyUmVzcG9uc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlZ2lzdGVyUmVzcG9uc2UgPSBudWxsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9nb3V0XCIpXHJcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IG51bGxcclxuICAgICAgICAgICAgVXNlclN2Yy5sb2dvdXQoKVxyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoVXNlclN2Yy5pc1Nlc3Npb25BY3RpdmUoKSkge1xyXG4gICAgICAgICAgICBVc2VyU3ZjLmdldFVzZXIoKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3ZjLCAkbG9jYXRpb24pIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9KSIsImFwcC5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFBvc3RzU3ZjKSB7XHJcbiAgICAkc2NvcGUuYWRkUG9zdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICgkc2NvcGUucG9zdEJvZHkpIHtcclxuICAgICAgICAgICAgUG9zdHNTdmMuY3JlYXRlKHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAnbnl3ZXJvbicsXHJcbiAgICAgICAgICAgICAgICBib2R5OiAkc2NvcGUucG9zdEJvZHlcclxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihwb3N0KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucG9zdEJvZHkgPSBudWxsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHtcclxuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUucG9zdHMudW5zaGlmdChwb3N0KVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG5cclxuICAgIFBvc3RzU3ZjLmZldGNoKCkuc3VjY2VzcyhmdW5jdGlvbihwb3N0cykge1xyXG4gICAgICAgICRzY29wZS5wb3N0cyA9IHBvc3RzXHJcbiAgICB9KVxyXG5cclxufSkiLCJhcHAuc2VydmljZSgnUG9zdHNTdmMnLCBbJyRodHRwJywgZnVuY3Rpb24oJGh0dHApIHtcclxuICAgIHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvcG9zdHMnKVxyXG4gICAgfVxyXG4gICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KSB7XHJcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9wb3N0cycsIHBvc3QpXHJcbiAgICB9XHJcbn1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2Yykge1xyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUubmFtZVJlcXVpcmVkID0gJydcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnJ1xyXG5cclxuICAgICAgICAgICAgaWYgKCF1c2VybmFtZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hbWVSZXF1aXJlZCA9ICdOYW1lIFJlcXVpcmVkJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lUmVxdWlyZWQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnUGFzc3dvcmQgUmVxdWlyZWQnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclN2Yy5yZWdpc3Rlcih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdyZWdpc3RlcicsIFwiS29udG8gemFyZWplc3Ryb3dhbmUgcG9wcmF3bmllLCB6YWxvZ3VqIHNpxJkuXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VybmFtZSA9IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7fVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oJy8nLCB7IGNvbnRyb2xsZXI6ICdQb3N0c0N0cmwnLCB0ZW1wbGF0ZVVybDogJ3Bvc3RzLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7IGNvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnLCB0ZW1wbGF0ZVVybDogJ3JlZ2lzdGVyLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvbG9naW4nLCB7IGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvbG9nb3V0JywgeyBjb250cm9sbGVyOiAnQXBwbGljYXRpb25DdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxyXG4gICAgfSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdVc2VyU3ZjJywgZnVuY3Rpb24oJGh0dHAsICR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3ZjID0gdGhpc1xyXG4gICAgICAgIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy91c2VycycpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9zZXNzaW9ucycsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBzdmMudG9rZW4gPSByZXNwb25zZS5kYXRhXHJcbiAgICAgICAgICAgICAgICBzdmMuc2V0VG9rZW4oc3ZjLnRva2VuKVxyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXRVc2VyKClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvdXNlcnMnLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY2xlYXIoKVxyXG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5zZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbiA9IHRva2VuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW5cclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLmlzU2Vzc2lvbkFjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPyB0cnVlIDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLnNldFhBdXRoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSBzdmMuZ2V0VG9rZW4oKVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnV2ViU29ja2V0U3ZjJywgZnVuY3Rpb24oJHJvb3RTY29wZSkge1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB3ZWJzb2NrZXRIb3N0KCkge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSBcImh0dHBzOlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ3c3M6Ly9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3M6Ly9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY29ubmVjdGlvblxyXG5cclxuICAgICAgICB0aGlzLmNvbm5lY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQod2Vic29ja2V0SG9zdCgpKVxyXG5cclxuXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZS5kYXRhKVxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3czonICsgcGF5bG9hZC50b3BpYywgcGF5bG9hZC5kYXRhKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNlbmQgPSBmdW5jdGlvbih0b3BpYywgZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHsgdG9waWM6IHRvcGljLCBkYXRhOiBkYXRhIH0pXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VuZChqc29uKVxyXG4gICAgICAgIH1cclxuICAgIH0pLnJ1bihmdW5jdGlvbihXZWJTb2NrZXRTdmMpIHtcclxuICAgICAgICBXZWJTb2NrZXRTdmMuY29ubmVjdCgpXHJcbiAgICB9KSJdfQ==
