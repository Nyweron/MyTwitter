var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$location",function(e,o,t){e.$on("login",function(o,t){e.currentUser=t}),e.$on("register",function(o,t){e.registerResponse=t}),e.disableRegisterResponse=function(){e.registerResponse=null},e.logout=function(){console.log("logout"),e.currentUser=null,o.logout(),t.path("/")};var n=o.getToken();console.log("getToken",n);var r=o.isSessionActive();console.log("isSessionActiovate",r);var s=o.setXAuth();console.log("xauth:"+s),r&&(console.log("Te"),console.log("XXX:",o.getUser()),o.getUser().then(function(o){e.currentUser=o}))}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,o,t){e.login=function(n,r){o.login(n,r).then(function(o){e.$emit("login",o),t.path("/")})}}]),app.controller("PostsCtrl",["$scope","PostsSvc",function(e,o){e.addPost=function(){e.postBody&&o.create({username:"nyweron",body:e.postBody}).success(function(o){e.postBody=null})},e.$on("ws:new_post",function(o,t){e.$apply(function(){e.posts.unshift(t)})}),o.fetch().success(function(o){e.posts=o})}]),app.service("PostsSvc",["$http",function(e){this.fetch=function(){return e.get("/posts")},this.create=function(o){return e.post("/posts",o)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,o){e.register=function(t,n){e.nameRequired="",e.passwordRequired="",e.nameRequired=t?"":"Name Required",e.passwordRequired=n?"":"Password Required",t&&n&&o.register(t,n).then(function(o){e.$emit("register","Konto zarejestrowane poprawnie, zaloguj siÄ™."),e.username="",e.password=""})}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"ApplicationCtrl",templateUrl:"posts.html"})}]),angular.module("app").service("UserSvc",["$http","$window",function(e,o){var t=this;t.getUser=function(){return e.get("/users").then(function(e){return e.data})},t.login=function(o,n){return e.post("/sessions",{username:o,password:n}).then(function(o){return t.token=o.data,t.setToken(t.token),e.defaults.headers.common["X-Auth"]=o.data,t.getUser()})},t.register=function(o,t){return e.post("/users",{username:o,password:t}).then(function(e){return e})},t.logout=function(){o.localStorage.clear(),delete e.defaults.headers.common["X-Auth"]},t.setToken=function(e){return o.localStorage.token=e},t.getToken=function(){return o.localStorage.token},t.isSessionActive=function(){return!!o.localStorage.token},t.setXAuth=function(){return e.defaults.headers.common["X-Auth"]=t.getToken()}}]),angular.module("app").service("WebSocketSvc",["$rootScope",function(e){function o(){return"https:"===window.location.protocol?"wss://"+window.location.host:"ws://"+window.location.host}var t;this.connect=function(){(t=new WebSocket(o())).onopen=function(){console.log("WebSocket connected")},t.onmessage=function(o){var t=JSON.parse(o.data);e.$broadcast("ws:"+t.topic,t.data)}},this.send=function(e,o){var n=JSON.stringify({topic:e,data:o});t.send(n)}}]).run(["WebSocketSvc",function(e){e.connect()}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuc3ZjLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsIiRvbiIsIl8iLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJyZXNwb25zZSIsInJlZ2lzdGVyUmVzcG9uc2UiLCJkaXNhYmxlUmVnaXN0ZXJSZXNwb25zZSIsImxvZ291dCIsImNvbnNvbGUiLCJsb2ciLCJwYXRoIiwiZ2V0VG9rZW4iLCJpc1Nlc3Npb25BY3Rpb3ZhdGUiLCJpc1Nlc3Npb25BY3RpdmUiLCJ4YXV0aCIsInNldFhBdXRoIiwiZ2V0VXNlciIsInRoZW4iLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCIkZW1pdCIsIlBvc3RzU3ZjIiwiYWRkUG9zdCIsInBvc3RCb2R5IiwiY3JlYXRlIiwiYm9keSIsInN1Y2Nlc3MiLCJwb3N0IiwiJGFwcGx5IiwicG9zdHMiLCJ1bnNoaWZ0IiwiZmV0Y2giLCJzZXJ2aWNlIiwiJGh0dHAiLCJ0aGlzIiwiZ2V0IiwicmVnaXN0ZXIiLCJuYW1lUmVxdWlyZWQiLCJwYXNzd29yZFJlcXVpcmVkIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCIkd2luZG93Iiwic3ZjIiwiZGF0YSIsInRva2VuIiwic2V0VG9rZW4iLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJsb2NhbFN0b3JhZ2UiLCJjbGVhciIsIiRyb290U2NvcGUiLCJ3ZWJzb2NrZXRIb3N0Iiwid2luZG93IiwibG9jYXRpb24iLCJwcm90b2NvbCIsImhvc3QiLCJjb25uZWN0aW9uIiwiY29ubmVjdCIsIldlYlNvY2tldCIsIm9ub3BlbiIsIm9ubWVzc2FnZSIsImUiLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwiJGJyb2FkY2FzdCIsInRvcGljIiwic2VuZCIsImpzb24iLCJzdHJpbmdpZnkiLCJydW4iLCJXZWJTb2NrZXRTdmMiXSwibWFwcGluZ3MiOiJBQUFBLElBQUFBLElBQUFDLFFBQUFDLE9BQUEsT0FDQSxZQ0RBRCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsbUJBQUEsU0FBQSxVQUFBLFlBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQUcsSUFBQSxRQUFBLFNBQUFDLEVBQUFDLEdBQ0FMLEVBQUFNLFlBQUFELElBRUFMLEVBQUFHLElBQUEsV0FBQSxTQUFBQyxFQUFBRyxHQUNBUCxFQUFBUSxpQkFBQUQsSUFHQVAsRUFBQVMsd0JBQUEsV0FDQVQsRUFBQVEsaUJBQUEsTUFHQVIsRUFBQVUsT0FBQSxXQUNBQyxRQUFBQyxJQUFBLFVBQ0FaLEVBQUFNLFlBQUEsS0FDQUwsRUFBQVMsU0FDQVIsRUFBQVcsS0FBQSxNQUdBLElBQUFDLEVBQUFiLEVBQUFhLFdBQ0FILFFBQUFDLElBQUEsV0FBQUUsR0FFQSxJQUFBQyxFQUFBZCxFQUFBZSxrQkFDQUwsUUFBQUMsSUFBQSxxQkFBQUcsR0FFQSxJQUFBRSxFQUFBaEIsRUFBQWlCLFdBQ0FQLFFBQUFDLElBQUEsU0FBQUssR0FFQUYsSUFDQUosUUFBQUMsSUFBQSxNQUNBRCxRQUFBQyxJQUFBLE9BQUFYLEVBQUFrQixXQUNBbEIsRUFBQWtCLFVBQUFDLEtBQUEsU0FBQWYsR0FDQUwsRUFBQU0sWUFBQUQsUUNqQ0FSLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0FGLEVBQUFxQixNQUFBLFNBQUFDLEVBQUFDLEdBQ0F0QixFQUFBb0IsTUFBQUMsRUFBQUMsR0FDQUgsS0FBQSxTQUFBZixHQUNBTCxFQUFBd0IsTUFBQSxRQUFBbkIsR0FDQUgsRUFBQVcsS0FBQSxXQ05BakIsSUFB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QSxZQUNBRCxFQUFBLElBQUFFLFVBQUFQLE1BR0FRLE9BQUEsV0FDQXZELFFBQUFDLElBQUEsd0JBRUFtRCxFQUFBSSxVQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUMsS0FBQUMsTUFBQUgsRUFBQW5CLE1BQ0FRLEVBQUFlLFdBQUEsTUFBQUgsRUFBQUksTUFBQUosRUFBQXBCLFFBSUFYLEtBQUFvQyxLQUFBLFNBQUFELEVBQUF4QixHQUNBLElBQUEwQixFQUFBTCxLQUFBTSxXQUFBSCxNQUFBQSxFQUFBeEIsS0FBQUEsSUFDQWMsRUFBQVcsS0FBQUMsT0FFQUUsS0FBQSxlQUFBLFNBQUFDLEdBQ0FBLEVBQUFkIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xyXG4gICAgJ25nUm91dGUnXHJcbl0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3ZjLCAkbG9jYXRpb24pIHtcclxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlclxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgJHNjb3BlLiRvbigncmVnaXN0ZXInLCBmdW5jdGlvbihfLCByZXNwb25zZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUucmVnaXN0ZXJSZXNwb25zZSA9IHJlc3BvbnNlXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgJHNjb3BlLmRpc2FibGVSZWdpc3RlclJlc3BvbnNlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWdpc3RlclJlc3BvbnNlID0gbnVsbFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImxvZ291dFwiKVxyXG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSBudWxsXHJcbiAgICAgICAgICAgIFVzZXJTdmMubG9nb3V0KClcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGdldFRva2VuID0gVXNlclN2Yy5nZXRUb2tlbigpXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJnZXRUb2tlblwiLCBnZXRUb2tlbilcclxuXHJcbiAgICAgICAgdmFyIGlzU2Vzc2lvbkFjdGlvdmF0ZSA9IFVzZXJTdmMuaXNTZXNzaW9uQWN0aXZlKClcclxuICAgICAgICBjb25zb2xlLmxvZyhcImlzU2Vzc2lvbkFjdGlvdmF0ZVwiLCBpc1Nlc3Npb25BY3Rpb3ZhdGUpXHJcblxyXG4gICAgICAgIHZhciB4YXV0aCA9IFVzZXJTdmMuc2V0WEF1dGgoKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwieGF1dGg6XCIgKyB4YXV0aClcclxuXHJcbiAgICAgICAgaWYgKGlzU2Vzc2lvbkFjdGlvdmF0ZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRlXCIpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiWFhYOlwiLCBVc2VyU3ZjLmdldFVzZXIoKSlcclxuICAgICAgICAgICAgVXNlclN2Yy5nZXRVc2VyKCkudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfSkiLCJhcHAuY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBQb3N0c1N2Yykge1xyXG4gICAgJHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoJHNjb3BlLnBvc3RCb2R5KSB7XHJcbiAgICAgICAgICAgIFBvc3RzU3ZjLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJ255d2Vyb24nLFxyXG4gICAgICAgICAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5XHJcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RCb2R5ID0gbnVsbFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgJHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KSB7XHJcbiAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdClcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICBQb3N0c1N2Yy5mZXRjaCgpLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpIHtcclxuICAgICAgICAkc2NvcGUucG9zdHMgPSBwb3N0c1xyXG4gICAgfSlcclxuXHJcbn0pIiwiYXBwLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgWyckaHR0cCcsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICB0aGlzLmZldGNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3Bvc3RzJylcclxuICAgIH1cclxuICAgIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24ocG9zdCkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvcG9zdHMnLCBwb3N0KVxyXG4gICAgfVxyXG59XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTdmMpIHtcclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm5hbWVSZXF1aXJlZCA9ICcnXHJcbiAgICAgICAgICAgICRzY29wZS5wYXNzd29yZFJlcXVpcmVkID0gJydcclxuXHJcbiAgICAgICAgICAgIGlmICghdXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lUmVxdWlyZWQgPSAnTmFtZSBSZXF1aXJlZCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmFtZVJlcXVpcmVkID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzd29yZFJlcXVpcmVkID0gJ1Bhc3N3b3JkIFJlcXVpcmVkJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzd29yZFJlcXVpcmVkID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAodXNlcm5hbWUgJiYgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgIFVzZXJTdmMucmVnaXN0ZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgncmVnaXN0ZXInLCBcIktvbnRvIHphcmVqZXN0cm93YW5lIHBvcHJhd25pZSwgemFsb2d1aiBzacSZLlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXNzd29yZCA9IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9IGVsc2Uge31cclxuICAgICAgICB9XHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvJywgeyBjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywgeyBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywgeyBjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL2xvZ291dCcsIHsgY29udHJvbGxlcjogJ0FwcGxpY2F0aW9uQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCcgfSlcclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwLCAkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN2YyA9IHRoaXNcclxuICAgICAgICBzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvdXNlcnMnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvc2Vzc2lvbnMnLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc3ZjLnRva2VuID0gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgc3ZjLnNldFRva2VuKHN2Yy50b2tlbilcclxuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHJlc3BvbnNlLmRhdGFcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0VXNlcigpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3VzZXJzJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmNsZWFyKClcclxuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMuc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPSB0b2tlblxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMuZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5pc1Nlc3Npb25BY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuID8gdHJ1ZSA6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5zZXRYQXV0aCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gc3ZjLmdldFRva2VuKClcclxuICAgICAgICB9XHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLnNlcnZpY2UoJ1dlYlNvY2tldFN2YycsIGZ1bmN0aW9uKCRyb290U2NvcGUpIHtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2Vic29ja2V0SG9zdCgpIHtcclxuICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gXCJodHRwczpcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3NzOi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdFxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIndzOi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdFxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGNvbm5lY3Rpb25cclxuXHJcbiAgICAgICAgdGhpcy5jb25uZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KHdlYnNvY2tldEhvc3QoKSlcclxuXHJcblxyXG4gICAgICAgICAgICBjb25uZWN0aW9uLm9ub3BlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjb25uZWN0ZWQnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSlcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnd3M6JyArIHBheWxvYWQudG9waWMsIHBheWxvYWQuZGF0YSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kID0gZnVuY3Rpb24odG9waWMsIGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh7IHRvcGljOiB0b3BpYywgZGF0YTogZGF0YSB9KVxyXG4gICAgICAgICAgICBjb25uZWN0aW9uLnNlbmQoanNvbilcclxuICAgICAgICB9XHJcbiAgICB9KS5ydW4oZnVuY3Rpb24oV2ViU29ja2V0U3ZjKSB7XHJcbiAgICAgICAgV2ViU29ja2V0U3ZjLmNvbm5lY3QoKVxyXG4gICAgfSkiXX0=
