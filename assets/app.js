var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$location",function(e,t,n){e.$on("login",function(t,n){e.currentUser=n}),e.$on("register",function(t,n){e.registerResponse=n}),e.disableRegisterResponse=function(){e.registerResponse=null},e.logout=function(){e.currentUser=null,t.logout(),n.path("/")},t.isSessionActive()&&(t.setXAuth(),t.getUser().then(function(t){e.currentUser=t}))}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,t,n){e.login=function(o,r){t.login(o,r).then(function(t){e.$emit("login",t),n.path("/")})}}]),app.controller("PostsCtrl",["$scope","PostsSvc",function(e,t){e.addPost=function(){e.postBody&&t.create({username:"nyweron",body:e.postBody}).success(function(t){e.postBody=null})},e.$on("ws:new_post",function(t,n){e.$apply(function(){e.posts.unshift(n)})}),t.fetch().success(function(t){e.posts=t})}]),app.service("PostsSvc",["$http",function(e){this.fetch=function(){return e.get("/posts")},this.create=function(t){return e.post("/posts",t)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,t){e.register=function(n,o){console.log("tempp"),e.nameRequired="",e.passwordRequired="",e.nameRequired=n?"":"Name Required",e.passwordRequired=o?"":"Password Required",n&&o&&t.register(n,o).then(function(t){e.$emit("register","Konto zarejestrowane poprawnie, zaloguj siÄ™."),e.username="",e.password=""})}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"ApplicationCtrl",templateUrl:"posts.html"})}]),angular.module("app").service("UserSvc",["$http","$window",function(e,t){var n=this;n.getUser=function(){return e.get("/users").then(function(e){return e.data})},n.login=function(t,o){return e.post("/sessions",{username:t,password:o}).then(function(t){return n.token=t.data,n.setToken(n.token),e.defaults.headers.common["X-Auth"]=t.data,n.getUser()})},n.register=function(t,n){return e.post("/users",{username:t,password:n}).then(function(e){return e})},n.logout=function(){t.localStorage.clear(),delete e.defaults.headers.common["X-Auth"]},n.setToken=function(e){return t.localStorage.token=e},n.getToken=function(){return t.localStorage.token},n.isSessionActive=function(){return!!t.localStorage.token},n.setXAuth=function(){return e.defaults.headers.common["X-Auth"]=n.getToken()}}]),angular.module("app").service("WebSocketSvc",["$rootScope",function(e){function t(){return"https:"===window.location.protocol?"wss://"+window.location.host:"ws://"+window.location.host}var n;this.connect=function(){(n=new WebSocket(t())).onopen=function(){console.log("WebSocket connected")},n.onmessage=function(t){var n=JSON.parse(t.data);e.$broadcast("ws:"+n.topic,n.data)}},this.send=function(e,t){var o=JSON.stringify({topic:e,data:t});n.send(o)}}]).run(["WebSocketSvc",function(e){e.connect()}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuc3ZjLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsIiRvbiIsIl8iLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJyZXNwb25zZSIsInJlZ2lzdGVyUmVzcG9uc2UiLCJkaXNhYmxlUmVnaXN0ZXJSZXNwb25zZSIsImxvZ291dCIsInBhdGgiLCJpc1Nlc3Npb25BY3RpdmUiLCJzZXRYQXV0aCIsImdldFVzZXIiLCJ0aGVuIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiJGVtaXQiLCJQb3N0c1N2YyIsImFkZFBvc3QiLCJwb3N0Qm9keSIsImNyZWF0ZSIsImJvZHkiLCJzdWNjZXNzIiwicG9zdCIsIiRhcHBseSIsInBvc3RzIiwidW5zaGlmdCIsImZldGNoIiwic2VydmljZSIsIiRodHRwIiwidGhpcyIsImdldCIsInJlZ2lzdGVyIiwiY29uc29sZSIsImxvZyIsIm5hbWVSZXF1aXJlZCIsInBhc3N3b3JkUmVxdWlyZWQiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsIiR3aW5kb3ciLCJzdmMiLCJkYXRhIiwidG9rZW4iLCJzZXRUb2tlbiIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsImxvY2FsU3RvcmFnZSIsImNsZWFyIiwiZ2V0VG9rZW4iLCIkcm9vdFNjb3BlIiwid2Vic29ja2V0SG9zdCIsIndpbmRvdyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJob3N0IiwiY29ubmVjdGlvbiIsImNvbm5lY3QiLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIiRicm9hZGNhc3QiLCJ0b3BpYyIsInNlbmQiLCJqc29uIiwic3RyaW5naWZ5IiwicnVuIiwiV2ViU29ja2V0U3ZjIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFBQSxJQUFBQyxRQUFBQyxPQUFBLE9BQ0EsWUNEQUQsUUFBQUMsT0FBQSxPQUNBQyxXQUFBLG1CQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0FGLEVBQUFHLElBQUEsUUFBQSxTQUFBQyxFQUFBQyxHQUNBTCxFQUFBTSxZQUFBRCxJQUVBTCxFQUFBRyxJQUFBLFdBQUEsU0FBQUMsRUFBQUcsR0FDQVAsRUFBQVEsaUJBQUFELElBRUFQLEVBQUFTLHdCQUFBLFdBQ0FULEVBQUFRLGlCQUFBLE1BRUFSLEVBQUFVLE9BQUEsV0FDQVYsRUFBQU0sWUFBQSxLQUNBTCxFQUFBUyxTQUNBUixFQUFBUyxLQUFBLE1BR0FWLEVBQUFXLG9CQUNBWCxFQUFBWSxXQUNBWixFQUFBYSxVQUFBQyxLQUFBLFNBQUFWLEdBQ0FMLEVBQUFNLFlBQUFELFFDcEJBUixRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsYUFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBRixFQUFBZ0IsTUFBQSxTQUFBQyxFQUFBQyxHQUNBakIsRUFBQWUsTUFBQUMsRUFBQUMsR0FDQUgsS0FBQSxTQUFBVixHQUNBTCxFQUFBbUIsTUFBQSxRQUFBZCxHQUNBSCxFQUFBUyxLQUFBLFdDTkFmLElBQUFHLFdBQUEsYUFBQSxTQUFBLFdBQUEsU0FBQUMsRUFBQW9CLEdBQ0FwQixFQUFBcUIsUUFBQSxXQUNBckIsRUFBQXNCLFVBQ0FGLEVBQUFHLFFBQ0FOLFNBQUEsVUFDQU8sS0FBQXhCLEVBQUFzQixXQUNBRyxRQUFBLFNBQUFDLEdBQ0ExQixFQUFBc0IsU0FBQSxRQU1BdEIsRUFBQUcsSUFBQSxjQUFBLFNBQUFDLEVBQUFzQixHQUNBMUIsRUFBQTJCLE9BQUEsV0FDQTNCLEVBQUE0QixNQUFB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QUwsS0FBQU0sV0FBQUgsTUFBQUEsRUFBQXpCLEtBQUFBLElBQ0FlLEVBQUFXLEtBQUFDLE9BRUFFLEtBQUEsZUFBQSxTQUFBQyxHQUNBQSxFQUFBZCIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcclxuICAgICduZ1JvdXRlJ1xyXG5dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihfLCB1c2VyKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXJcclxuICAgICAgICB9KVxyXG4gICAgICAgICRzY29wZS4kb24oJ3JlZ2lzdGVyJywgZnVuY3Rpb24oXywgcmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlZ2lzdGVyUmVzcG9uc2UgPSByZXNwb25zZVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgJHNjb3BlLmRpc2FibGVSZWdpc3RlclJlc3BvbnNlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWdpc3RlclJlc3BvbnNlID0gbnVsbFxyXG4gICAgICAgIH1cclxuICAgICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IG51bGxcclxuICAgICAgICAgICAgVXNlclN2Yy5sb2dvdXQoKVxyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoVXNlclN2Yy5pc1Nlc3Npb25BY3RpdmUoKSkge1xyXG4gICAgICAgICAgICBVc2VyU3ZjLnNldFhBdXRoKClcclxuICAgICAgICAgICAgVXNlclN2Yy5nZXRVc2VyKCkudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJylcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfSkiLCJhcHAuY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBQb3N0c1N2Yykge1xyXG4gICAgJHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoJHNjb3BlLnBvc3RCb2R5KSB7XHJcbiAgICAgICAgICAgIFBvc3RzU3ZjLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJ255d2Vyb24nLFxyXG4gICAgICAgICAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5XHJcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RCb2R5ID0gbnVsbFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgJHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KSB7XHJcbiAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdClcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICBQb3N0c1N2Yy5mZXRjaCgpLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpIHtcclxuICAgICAgICAkc2NvcGUucG9zdHMgPSBwb3N0c1xyXG4gICAgfSlcclxuXHJcbn0pIiwiYXBwLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgWyckaHR0cCcsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICB0aGlzLmZldGNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3Bvc3RzJylcclxuICAgIH1cclxuICAgIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24ocG9zdCkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvcG9zdHMnLCBwb3N0KVxyXG4gICAgfVxyXG59XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTdmMpIHtcclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGVtcHBcIik7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUubmFtZVJlcXVpcmVkID0gJydcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnJ1xyXG5cclxuICAgICAgICAgICAgaWYgKCF1c2VybmFtZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hbWVSZXF1aXJlZCA9ICdOYW1lIFJlcXVpcmVkJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lUmVxdWlyZWQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnUGFzc3dvcmQgUmVxdWlyZWQnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkUmVxdWlyZWQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclN2Yy5yZWdpc3Rlcih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdyZWdpc3RlcicsIFwiS29udG8gemFyZWplc3Ryb3dhbmUgcG9wcmF3bmllLCB6YWxvZ3VqIHNpxJkuXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VybmFtZSA9IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7fVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oJy8nLCB7IGNvbnRyb2xsZXI6ICdQb3N0c0N0cmwnLCB0ZW1wbGF0ZVVybDogJ3Bvc3RzLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7IGNvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnLCB0ZW1wbGF0ZVVybDogJ3JlZ2lzdGVyLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvbG9naW4nLCB7IGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvbG9nb3V0JywgeyBjb250cm9sbGVyOiAnQXBwbGljYXRpb25DdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxyXG4gICAgfSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5zZXJ2aWNlKCdVc2VyU3ZjJywgZnVuY3Rpb24oJGh0dHAsICR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3ZjID0gdGhpc1xyXG4gICAgICAgIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy91c2VycycpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9zZXNzaW9ucycsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBzdmMudG9rZW4gPSByZXNwb25zZS5kYXRhXHJcbiAgICAgICAgICAgICAgICBzdmMuc2V0VG9rZW4oc3ZjLnRva2VuKVxyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXRVc2VyKClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvdXNlcnMnLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY2xlYXIoKVxyXG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5zZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbiA9IHRva2VuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW5cclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLmlzU2Vzc2lvbkFjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPyB0cnVlIDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLnNldFhBdXRoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSBzdmMuZ2V0VG9rZW4oKVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnV2ViU29ja2V0U3ZjJywgZnVuY3Rpb24oJHJvb3RTY29wZSkge1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB3ZWJzb2NrZXRIb3N0KCkge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSBcImh0dHBzOlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ3c3M6Ly9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3M6Ly9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY29ubmVjdGlvblxyXG5cclxuICAgICAgICB0aGlzLmNvbm5lY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQod2Vic29ja2V0SG9zdCgpKVxyXG5cclxuXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZS5kYXRhKVxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3czonICsgcGF5bG9hZC50b3BpYywgcGF5bG9hZC5kYXRhKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNlbmQgPSBmdW5jdGlvbih0b3BpYywgZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHsgdG9waWM6IHRvcGljLCBkYXRhOiBkYXRhIH0pXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VuZChqc29uKVxyXG4gICAgICAgIH1cclxuICAgIH0pLnJ1bihmdW5jdGlvbihXZWJTb2NrZXRTdmMpIHtcclxuICAgICAgICBXZWJTb2NrZXRTdmMuY29ubmVjdCgpXHJcbiAgICB9KSJdfQ==
