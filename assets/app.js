var app=angular.module("app",["ngRoute"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$location",function(e,t,n){e.$on("login",function(t,n){e.currentUser=n}),e.$on("register",function(t,n){e.registerResponse=n}),e.disableRegisterResponse=function(){e.registerResponse=null},e.logout=function(){e.currentUser=null,t.logout(),n.path("/")},t.isSessionActive()&&(t.setXAuth(),t.getUser().then(function(t){e.currentUser=t}))}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,t,n){e.login=function(o,r){t.login(o,r).then(function(t){e.$emit("login",t),n.path("/")})}}]),app.controller("PostsCtrl",["$scope","PostsSvc",function(e,t){e.addPost=function(){e.postBody&&t.create({username:"nyweron",body:e.postBody}).success(function(t){e.postBody=null})},e.$on("ws:new_post",function(t,n){e.$apply(function(){e.posts.unshift(n)})}),t.fetch().success(function(t){e.posts=t})}]),app.service("PostsSvc",["$http",function(e){this.fetch=function(){return e.get("/posts")},this.create=function(t){return e.post("/posts",t)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,t){e.register=function(n,o){e.nameRequired="",e.passwordRequired="",e.nameRequired=n?"":"Name Required",e.passwordRequired=o?"":"Password Required",n&&o&&t.register(n,o).then(function(t){e.$emit("register","Konto zarejestrowane poprawnie, zaloguj siÄ™."),e.username="",e.password=""})},e.list=[{id:1,type:"",name:"email",required:"true",placeholder:"Enter email address"},{id:2,type:"",name:"password",required:"true",placeholder:"Enter password"},{id:3,type:"",name:"nickname",required:"false",placeholder:"Enter nickname"},{id:4,type:"",name:"username",required:"false",placeholder:"Enter username"},{id:5,type:"",name:"lastname",required:"false",placeholder:"Enter lastname"},{id:6,type:"",name:"age",required:"false",placeholder:"Enter age"}]}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"ApplicationCtrl",templateUrl:"posts.html"})}]),angular.module("app").service("UserSvc",["$http","$window",function(e,t){var n=this;n.getUser=function(){return e.get("/users").then(function(e){return e.data})},n.login=function(t,o){return e.post("/sessions",{username:t,password:o}).then(function(t){return n.token=t.data,n.setToken(n.token),e.defaults.headers.common["X-Auth"]=t.data,n.getUser()})},n.register=function(t,n){return e.post("/users",{username:t,password:n}).then(function(e){return e})},n.logout=function(){t.localStorage.clear(),delete e.defaults.headers.common["X-Auth"]},n.setToken=function(e){return t.localStorage.token=e},n.getToken=function(){return t.localStorage.token},n.isSessionActive=function(){return!!t.localStorage.token},n.setXAuth=function(){return e.defaults.headers.common["X-Auth"]=n.getToken()}}]),angular.module("app").service("WebSocketSvc",["$rootScope",function(e){function t(){return"https:"===window.location.protocol?"wss://"+window.location.host:"ws://"+window.location.host}var n;this.connect=function(){(n=new WebSocket(t())).onopen=function(){console.log("WebSocket connected")},n.onmessage=function(t){var n=JSON.parse(t.data);e.$broadcast("ws:"+n.topic,n.data)}},this.send=function(e,t){var o=JSON.stringify({topic:e,data:t});n.send(o)}}]).run(["WebSocketSvc",function(e){e.connect()}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuc3ZjLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsIiRvbiIsIl8iLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJyZXNwb25zZSIsInJlZ2lzdGVyUmVzcG9uc2UiLCJkaXNhYmxlUmVnaXN0ZXJSZXNwb25zZSIsImxvZ291dCIsInBhdGgiLCJpc1Nlc3Npb25BY3RpdmUiLCJzZXRYQXV0aCIsImdldFVzZXIiLCJ0aGVuIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiJGVtaXQiLCJQb3N0c1N2YyIsImFkZFBvc3QiLCJwb3N0Qm9keSIsImNyZWF0ZSIsImJvZHkiLCJzdWNjZXNzIiwicG9zdCIsIiRhcHBseSIsInBvc3RzIiwidW5zaGlmdCIsImZldGNoIiwic2VydmljZSIsIiRodHRwIiwidGhpcyIsImdldCIsInJlZ2lzdGVyIiwibmFtZVJlcXVpcmVkIiwicGFzc3dvcmRSZXF1aXJlZCIsImxpc3QiLCJpZCIsInR5cGUiLCJuYW1lIiwicmVxdWlyZWQiLCJwbGFjZWhvbGRlciIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiJHdpbmRvdyIsInN2YyIsImRhdGEiLCJ0b2tlbiIsInNldFRva2VuIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwibG9jYWxTdG9yYWdlIiwiY2xlYXIiLCJnZXRUb2tlbiIsIiRyb290U2NvcGUiLCJ3ZWJzb2NrZXRIb3N0Iiwid2luZG93IiwibG9jYXRpb24iLCJwcm90b2NvbCIsImhvc3QiLCJjb25uZWN0aW9uIiwiY29ubmVjdCIsIldlYlNvY2tldCIsIm9ub3BlbiIsImNvbnNvbGUiLCJsb2ciLCJvbm1lc3NhZ2UiLCJlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIiRicm9hZGNhc3QiLCJ0b3BpYyIsInNlbmQiLCJqc29uIiwic3RyaW5naWZ5IiwicnVuIiwiV2ViU29ja2V0U3ZjIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFBQSxJQUFBQyxRQUFBQyxPQUFBLE9BQ0EsWUNEQUQsUUFBQUMsT0FBQSxPQUNBQyxXQUFBLG1CQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0FGLEVBQUFHLElBQUEsUUFBQSxTQUFBQyxFQUFBQyxHQUNBTCxFQUFBTSxZQUFBRCxJQUVBTCxFQUFBRyxJQUFBLFdBQUEsU0FBQUMsRUFBQUcsR0FDQVAsRUFBQVEsaUJBQUFELElBRUFQLEVBQUFTLHdCQUFBLFdBQ0FULEVBQUFRLGlCQUFBLE1BRUFSLEVBQUFVLE9BQUEsV0FDQVYsRUFBQU0sWUFBQSxLQUNBTCxFQUFBUyxTQUNBUixFQUFBUyxLQUFBLE1BR0FWLEVBQUFXLG9CQUNBWCxFQUFBWSxXQUNBWixFQUFBYSxVQUFBQyxLQUFBLFNBQUFWLEdBQ0FMLEVBQUFNLFlBQUFELFFDcEJBUixRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsYUFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBRixFQUFBZ0IsTUFBQSxTQUFBQyxFQUFBQyxHQUNBakIsRUFBQWUsTUFBQUMsRUFBQUMsR0FDQUgsS0FBQSxTQUFBVixHQUNBTCxFQUFBbUIsTUFBQSxRQUFBZCxHQUNBSCxFQUFBUyxLQUFBLFdDTkFmLElBQUFHLFdBQUEsYUFBQSxTQUFBLFdBQUEsU0FBQUMsRUFBQW9CLEdBQ0FwQixFQUFBcUIsUUFBQSxXQUNBckIsRUFBQXNCLFVBQ0FGLEVBQUFHLFFBQ0FOLFNBQUEsVUFDQU8sS0FBQXhCLEVBQUFzQixXQUNBRyxRQUFBLFNBQUFDLEdBQ0ExQixFQUFBc0IsU0FBQSxRQU1BdEIsRUFBQUcsSUFBQSxjQUFB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QUFBQyxPQUFBLFVBQUFOLEVBQUFTLGVDMUNBN0QsUUFBQUMsT0FBQSxPQUNBaUMsUUFBQSxnQkFBQSxhQUFBLFNBQUE0QixHQUVBLFNBQUFDLElBQ0EsTUFBQSxXQUFBQyxPQUFBQyxTQUFBQyxTQUNBLFNBQUFGLE9BQUFDLFNBQUFFLEtBR0EsUUFBQUgsT0FBQUMsU0FBQUUsS0FLQSxJQUFBQyxFQUVBaEMsS0FBQWlDLFFBQUEsWUFDQUQsRUFBQSxJQUFBRSxVQUFBUCxNQUdBUSxPQUFBLFdBQ0FDLFFBQUFDLElBQUEsd0JBRUFMLEVBQUFNLFVBQUEsU0FBQUMsR0FDQSxJQUFBQyxFQUFBQyxLQUFBQyxNQUFBSCxFQUFBdEIsTUFDQVMsRUFBQWlCLFdBQUEsTUFBQUgsRUFBQUksTUFBQUosRUFBQXZCLFFBSUFqQixLQUFBNkMsS0FBQSxTQUFBRCxFQUFBM0IsR0FDQSxJQUFBNkIsRUFBQUwsS0FBQU0sV0FBQUgsTUFBQUEsRUFBQTNCLEtBQUFBLElBQ0FlLEVBQUFhLEtBQUFDLE9BRUFFLEtBQUEsZUFBQSxTQUFBQyxHQUNBQSxFQUFBaEIiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXHJcbiAgICAnbmdSb3V0ZSdcclxuXSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTdmMsICRsb2NhdGlvbikge1xyXG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oXywgdXNlcikge1xyXG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyXHJcbiAgICAgICAgfSlcclxuICAgICAgICAkc2NvcGUuJG9uKCdyZWdpc3RlcicsIGZ1bmN0aW9uKF8sIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWdpc3RlclJlc3BvbnNlID0gcmVzcG9uc2VcclxuICAgICAgICB9KVxyXG4gICAgICAgICRzY29wZS5kaXNhYmxlUmVnaXN0ZXJSZXNwb25zZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUucmVnaXN0ZXJSZXNwb25zZSA9IG51bGxcclxuICAgICAgICB9XHJcbiAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSBudWxsXHJcbiAgICAgICAgICAgIFVzZXJTdmMubG9nb3V0KClcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKFVzZXJTdmMuaXNTZXNzaW9uQWN0aXZlKCkpIHtcclxuICAgICAgICAgICAgVXNlclN2Yy5zZXRYQXV0aCgpXHJcbiAgICAgICAgICAgIFVzZXJTdmMuZ2V0VXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTdmMsICRsb2NhdGlvbikge1xyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcilcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiYXBwLmNvbnRyb2xsZXIoJ1Bvc3RzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUG9zdHNTdmMpIHtcclxuICAgICRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCRzY29wZS5wb3N0Qm9keSkge1xyXG4gICAgICAgICAgICBQb3N0c1N2Yy5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICdueXdlcm9uJyxcclxuICAgICAgICAgICAgICAgIGJvZHk6ICRzY29wZS5wb3N0Qm9keVxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKHBvc3QpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wb3N0Qm9keSA9IG51bGxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgICRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xyXG4gICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpXHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgUG9zdHNTdmMuZmV0Y2goKS5zdWNjZXNzKGZ1bmN0aW9uKHBvc3RzKSB7XHJcbiAgICAgICAgJHNjb3BlLnBvc3RzID0gcG9zdHNcclxuICAgIH0pXHJcblxyXG59KSIsImFwcC5zZXJ2aWNlKCdQb3N0c1N2YycsIFsnJGh0dHAnLCBmdW5jdGlvbigkaHR0cCkge1xyXG4gICAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9wb3N0cycpXHJcbiAgICB9XHJcbiAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHBvc3QpIHtcclxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3Bvc3RzJywgcG9zdClcclxuICAgIH1cclxufV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3ZjKSB7XHJcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5uYW1lUmVxdWlyZWQgPSAnJ1xyXG4gICAgICAgICAgICAkc2NvcGUucGFzc3dvcmRSZXF1aXJlZCA9ICcnXHJcblxyXG4gICAgICAgICAgICBpZiAoIXVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmFtZVJlcXVpcmVkID0gJ05hbWUgUmVxdWlyZWQnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hbWVSZXF1aXJlZCA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFzc3dvcmRSZXF1aXJlZCA9ICdQYXNzd29yZCBSZXF1aXJlZCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFzc3dvcmRSZXF1aXJlZCA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHVzZXJuYW1lICYmIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU3ZjLnJlZ2lzdGVyKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ3JlZ2lzdGVyJywgXCJLb250byB6YXJlamVzdHJvd2FuZSBwb3ByYXduaWUsIHphbG9ndWogc2nEmS5cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJuYW1lID0gXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFzc3dvcmQgPSBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSBlbHNlIHt9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICAkc2NvcGUubGlzdCA9W1xyXG4gICAgICAgICAgICAgICAge1wiaWRcIjogMSwgXCJ0eXBlXCI6IFwiXCIsIFwibmFtZVwiOiBcImVtYWlsXCIsICAgIFwicmVxdWlyZWRcIjogXCJ0cnVlXCIsIFwicGxhY2Vob2xkZXJcIjogXCJFbnRlciBlbWFpbCBhZGRyZXNzXCJ9LFxyXG4gICAgICAgICAgICAgICAge1wiaWRcIjogMiwgXCJ0eXBlXCI6IFwiXCIsIFwibmFtZVwiOiBcInBhc3N3b3JkXCIsIFwicmVxdWlyZWRcIjogXCJ0cnVlXCIsIFwicGxhY2Vob2xkZXJcIjogXCJFbnRlciBwYXNzd29yZFwifSxcclxuICAgICAgICAgICAgICAgIHtcImlkXCI6IDMsIFwidHlwZVwiOiBcIlwiLCBcIm5hbWVcIjogXCJuaWNrbmFtZVwiLCBcInJlcXVpcmVkXCI6IFwiZmFsc2VcIiwgXCJwbGFjZWhvbGRlclwiOiBcIkVudGVyIG5pY2tuYW1lXCJ9LFxyXG4gICAgICAgICAgICAgICAge1wiaWRcIjogNCwgXCJ0eXBlXCI6IFwiXCIsIFwibmFtZVwiOiBcInVzZXJuYW1lXCIsIFwicmVxdWlyZWRcIjogXCJmYWxzZVwiLCBcInBsYWNlaG9sZGVyXCI6IFwiRW50ZXIgdXNlcm5hbWVcIn0sXHJcbiAgICAgICAgICAgICAgICB7XCJpZFwiOiA1LCBcInR5cGVcIjogXCJcIiwgXCJuYW1lXCI6IFwibGFzdG5hbWVcIiwgXCJyZXF1aXJlZFwiOiBcImZhbHNlXCIsIFwicGxhY2Vob2xkZXJcIjogXCJFbnRlciBsYXN0bmFtZVwifSxcclxuICAgICAgICAgICAgICAgIHtcImlkXCI6IDYsIFwidHlwZVwiOiBcIlwiLCBcIm5hbWVcIjogXCJhZ2VcIiwgICAgICBcInJlcXVpcmVkXCI6IFwiZmFsc2VcIiwgXCJwbGFjZWhvbGRlclwiOiBcIkVudGVyIGFnZVwifVxyXG5cclxuICAgICAgICAgICAgXTsgXHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvJywgeyBjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0cy5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywgeyBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJywgdGVtcGxhdGVVcmw6ICdyZWdpc3Rlci5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywgeyBjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dpbi5odG1sJyB9KVxyXG4gICAgICAgICAgICAud2hlbignL2xvZ291dCcsIHsgY29udHJvbGxlcjogJ0FwcGxpY2F0aW9uQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCcgfSlcclxuICAgIH0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwLCAkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN2YyA9IHRoaXNcclxuICAgICAgICBzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvdXNlcnMnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ZjLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvc2Vzc2lvbnMnLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc3ZjLnRva2VuID0gcmVzcG9uc2UuZGF0YVxyXG4gICAgICAgICAgICAgICAgc3ZjLnNldFRva2VuKHN2Yy50b2tlbilcclxuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHJlc3BvbnNlLmRhdGFcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0VXNlcigpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3VzZXJzJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmNsZWFyKClcclxuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXVxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMuc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPSB0b2tlblxyXG4gICAgICAgIH1cclxuICAgICAgICBzdmMuZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5pc1Nlc3Npb25BY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuID8gdHJ1ZSA6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN2Yy5zZXRYQXV0aCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gc3ZjLmdldFRva2VuKClcclxuICAgICAgICB9XHJcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgLnNlcnZpY2UoJ1dlYlNvY2tldFN2YycsIGZ1bmN0aW9uKCRyb290U2NvcGUpIHtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2Vic29ja2V0SG9zdCgpIHtcclxuICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gXCJodHRwczpcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3NzOi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdFxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIndzOi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdFxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGNvbm5lY3Rpb25cclxuXHJcbiAgICAgICAgdGhpcy5jb25uZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KHdlYnNvY2tldEhvc3QoKSlcclxuXHJcblxyXG4gICAgICAgICAgICBjb25uZWN0aW9uLm9ub3BlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjb25uZWN0ZWQnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSlcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnd3M6JyArIHBheWxvYWQudG9waWMsIHBheWxvYWQuZGF0YSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kID0gZnVuY3Rpb24odG9waWMsIGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh7IHRvcGljOiB0b3BpYywgZGF0YTogZGF0YSB9KVxyXG4gICAgICAgICAgICBjb25uZWN0aW9uLnNlbmQoanNvbilcclxuICAgICAgICB9XHJcbiAgICB9KS5ydW4oZnVuY3Rpb24oV2ViU29ja2V0U3ZjKSB7XHJcbiAgICAgICAgV2ViU29ja2V0U3ZjLmNvbm5lY3QoKVxyXG4gICAgfSkiXX0=
